<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Clearance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f3e8;
        }

        .message-box {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-weight: 500;
        }

            .message-box.success {
                background-color: #d1fae5;
                color: #065f46;
            }

            .message-box.error {
                background-color: #fee2e2;
                color: #991b1b;
            }
    </style>
</head>
<body class="min-h-screen flex">

    <!-- sidebar -->
    <aside class="w-64 bg-[#1e7c37] text-white flex flex-col p-6">
        <div class="flex items-center space-x-2 mb-8">
            <div class="h-8 w-8 bg-white rounded-full flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#1e7c37" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 21.75a3 3 0 0 0 3 3h12.75a3 3 0 0 0 3-3V12a3 3 0 0 0-3-3h-1.5M15 9V3a1.5 1.5 0 0 0-1.5-1.5h-3A1.5 1.5 0 0 0 9 3v6m6 0a2.25 2.25 0 0 1 2.25 2.25V15h-4.5V11.25A2.25 2.25 0 0 1 15 9Z" />
                </svg>
            </div>
            <span class="text-xl font-bold">Welcome, Student!</span>
        </div>

        <nav class="flex flex-col flex-grow">
            <a href="#" id="applicationFormNav" class="text-white hover:bg-[#90b88e] py-3 px-4 rounded-lg font-bold transition-colors mb-2 bg-[#90b88e]">Application Form</a>
            <a href="#" id="requirementsNav" class="hidden text-white hover:bg-[#90b88e] py-3 px-4 rounded-lg font-bold transition-colors mb-2">Requirements</a>
        </nav>

        <!-- logout -->
        <div class="mt-auto">
            <button id="logoutButton" class="w-full py-3 px-4 rounded-lg bg-red-600 text-white font-bold hover:bg-red-700 transition-colors">LOG OUT</button>
        </div>
    </aside>

    <!-- main area -->
    <main class="flex-grow p-8">
        <div class="bg-white p-8 rounded-xl shadow-lg w-full h-full">
            <div id="applicationFormSection">
                <h2 class="text-2xl md:text-3xl font-bold text-[#1e7c37] mb-6">Application Form</h2>
                <form id="clearanceApplicationForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="col-span-1 md:col-span-1">
                        <label for="lastName" class="block text-gray-700 font-bold mb-2">Last Name</label>
                        <input type="text" id="lastName" name="lastName" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="firstName" class="block text-gray-700 font-bold mb-2">First Name</label>
                        <input type="text" id="firstName" name="firstName" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="mi" class="block text-gray-700 font-bold mb-2">M.I.</label>
                        <input type="text" id="mi" name="mi" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="contactNumber" class="block text-gray-700 font-bold mb-2">Contact Number</label>
                        <input type="tel" id="contactNumber" name="contactNumber" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="birthday" class="block text-gray-700 font-bold mb-2">Birthday</label>
                        <input type="date" id="birthday" name="birthday" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="sex" class="block text-gray-700 font-bold mb-2">Sex</label>
                        <select id="sex" name="sex" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                            <option value="">Select...</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="studentNumber" class="block text-gray-700 font-bold mb-2">Student Number</label>
                        <input type="text" id="studentNumber" name="studentNumber" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="department" class="block text-gray-700 font-bold mb-2">Department</label>
                        <input type="text" id="department" name="department" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="course" class="block text-gray-700 font-bold mb-2">Course</label>
                        <input type="text" id="course" name="course" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="yearLevel" class="block text-gray-700 font-bold mb-2">Year Level</label>
                        <input type="text" id="yearLevel" name="yearLevel" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="section" class="block text-gray-700 font-bold mb-2">Section</label>
                        <input type="text" id="section" name="section" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label for="emailAddress" class="block text-gray-700 font-bold mb-2">Email Address</label>
                        <input type="email" id="emailAddress" name="emailAddress" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]">
                    </div>
                    <div class="col-span-1 md:col-span-2">
                        <label for="purposeOfClearance" class="block text-gray-700 font-bold mb-2">Purpose of Clearance</label>
                        <textarea id="purposeOfClearance" name="purposeOfClearance" rows="3" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#90b88e]"></textarea>
                    </div>
                    <div class="col-span-1 md:col-span-2">
                        <button type="submit" class="w-full bg-[#1e7c37] text-white py-3 px-4 rounded-lg font-bold hover:bg-[#155a29] transition-colors">SUBMIT</button>
                    </div>
                    <div id="formMessage" class="message-box hidden col-span-1 md:col-span-2"></div>
                </form>
            </div>

            <div id="requirementsSection" class="hidden">
                <h2 class="text-2xl md:text-3xl font-bold text-[#1e7c37] mb-6">Current Clearance Status</h2>
                <div class="space-y-4 text-lg text-gray-800">
                    <table class="w-full text-left table-auto border-separate border-spacing-y-2">
                        <thead>
                            <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left rounded-l-lg">Department</th>
                                <th class="py-3 px-6 text-center rounded-r-lg">Status</th>
                            </tr>
                        </thead>
                        <tbody id="requirementsTableBody" class="text-gray-700 text-sm font-medium">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const formSection = document.getElementById('applicationFormSection');
            const requirementsSection = document.getElementById('requirementsSection');
            const requirementsNav = document.getElementById('requirementsNav');
            const applicationFormNav = document.getElementById('applicationFormNav');
            const logoutButton = document.getElementById('logoutButton');

            // render the static requirements table
            function renderStaticRequirements() {
                const tableBody = document.getElementById('requirementsTableBody');
                if (!tableBody) return;
                tableBody.innerHTML = '';
                const departments = ['Library', 'Accounting', 'Laboratory', 'Registrar'];
                departments.forEach(dept => {
                    const row = `
                                    <tr class="bg-gray-200">
                                        <td class="py-3 px-6 rounded-l-lg">${dept}</td>
                                        <td class="py-3 px-6 text-center rounded-r-lg">Pending</td>
                                    </tr>
                                `;
                    tableBody.innerHTML += row;
                });
            }

            // event listener for form submission
            document.getElementById('clearanceApplicationForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                const formMessage = document.getElementById('formMessage');
                formMessage.classList.add('hidden');

                const formData = {
                    lastName: document.getElementById('lastName').value,
                    firstName: document.getElementById('firstName').value,
                    mi: document.getElementById('mi').value,
                    contactNumber: document.getElementById('contactNumber').value,
                    birthday: document.getElementById('birthday').value,
                    sex: document.getElementById('sex').value,
                    studentNumber: document.getElementById('studentNumber').value,
                    department: document.getElementById('department').value,
                    course: document.getElementById('course').value,
                    yearLevel: document.getElementById('yearLevel').value,
                    section: document.getElementById('section').value,
                    emailAddress: document.getElementById('emailAddress').value,
                    purposeOfClearance: document.getElementById('purposeOfClearance').value,
                    submissionDate: new Date().toISOString()
                };

                try {
                    const response = await fetch('/api/clearance/apply', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData),
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    formMessage.textContent = 'Application submitted successfully! Your student number is ' + formData.studentNumber;
                    formMessage.classList.remove('hidden');
                    formMessage.classList.remove('error');
                    formMessage.classList.add('success');

                    formSection.classList.add('hidden');
                    requirementsSection.classList.remove('hidden');
                    requirementsNav.classList.remove('hidden');
                    applicationFormNav.classList.remove('bg-[#90b88e]');
                    requirementsNav.classList.add('bg-[#90b88e]');
                    renderStaticRequirements();

                } catch (e) {
                    console.error("Error submitting application: ", e);
                    formMessage.textContent = 'Error submitting application. Please try again.';
                    formMessage.classList.remove('hidden');
                    formMessage.classList.remove('success');
                    formMessage.classList.add('error');
                }
            });

            // event listener for navigation links
            applicationFormNav.addEventListener('click', function (e) {
                e.preventDefault();
                formSection.classList.remove('hidden');
                requirementsSection.classList.add('hidden');
                applicationFormNav.classList.add('bg-[#90b88e]');
                requirementsNav.classList.remove('bg-[#90b88e]');
            });

            requirementsNav.addEventListener('click', function (e) {
                e.preventDefault();
                formSection.classList.add('hidden');
                requirementsSection.classList.remove('hidden');
                applicationFormNav.classList.remove('bg-[#90b88e]');
                requirementsNav.classList.add('bg-[#90b88e]');
                renderStaticRequirements();
            });

            // Logout button event
            logoutButton.addEventListener('click', function () {
                localStorage.removeItem('jwtToken');
                window.location.href = '/index.html';
            });
        });
    </script>
</body>
</html>